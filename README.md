# DMSimulator
本ソフトウェアは、デッキの反復的な調整・練習の簡便化・プレイングの記録の簡便化を目的とした、デュエル・マスターズの一人回しをシミュレーションするためのシミュレーターです。
非公式のソフトとなりますので、私的利用に収まる範囲でご使用ください。


https://github.com/user-attachments/assets/4850c3ac-acf9-4530-be6e-2065a91b64cf


本ソフトは非営利であり、著作者の権益を侵害する意図はありません。配布停止の要望があった際には、速やかに対処致します。
このソフトウェアはファンコンテンツ・ポリシーに沿った非公式のファンコンテンツです。ウィザーズ社の認可/許諾は得ていません。題材の一部に、ウィザーズ・オブ・ザ・コースト社の財産を含んでいます。©Wizards of the Coast LLC.

# 機能
- デッキの動作を確認できます。カードのタップ・アンタップ、ドロー、重ねる、表裏を変える、順番を並び替える、ゾーン間を移動させるなどの通常のカードに対するアクションを行えます。
- Webカメラ映像（仮想カメラ）として画面を出力することができます。このとき、出力側カメラでは手札を非公開にするなど、手元とカメラ映像画面で表裏の表示を限定的に切り替えることができます。
- デュエパーティーのためにパートナーを設定することが可能です。
- カードやゾーンに対する操作を最小の手順で行えるようにしています。
  - カードは左クリックでドラッグ移動できる他、右クリックによってパイメニューが開き、マウスボタンを離すことでタップ、裏返すなどのアクションが実行できます。
  - 各ゾーンに対しても右クリックでパイメニューが開き、ゾーンのカードを展開する、全てをアンタップするなどのアクションが実行できます。
- Tabキーにより展開される「一時ゾーン」を実装しています。これにより、メクレイドでのカードの展開や、表向きになったカードを纏めてシャッフルして山札の下に戻すなどのアクションが行えます。
- スペースキーを押している間、大きくカードのプレビューが表示されます。　

# リミテーション
- 当ソフトを動かすためには、「デッキのカードの各画像」と「カードの裏面」の画像を使用者が準備する必要があります。デッキ製作をサポートする外部アプリを用い、[DownloadAllImages](https://chromewebstore.google.com/detail/download-all-images/nnffbdeachhbpfapjklmpnmjcgamcdmm?hl=en)などを用いて画像を集める必要があります。
- Unityが動くパソコンのみで動作します。また、アプリとして(現段階では)ビルドしていないため、Unity 2022.3.36f1のインストールが必要です。
- 通信対戦はできません。

# 将来的にやりたいこと(TODO)
- ゴッド・リンク
- ログの出力、及びログからの盤面の再生
  - 現状はクラッシュすると盤面を失ってしまう
- 非公開カードの記録、及び非公開カードのみのシャッフル
  - 対面練習のために、ログから盤面を再生後、非公開カードのみをシャッフルして続きを行えるようにしたい
- アドバンスの実装
  - 現状はオリジナル、デュエパのみ
- 多くのカードが置かれた時の表示の最適化

# ライセンス

本ソフトウェアおよび関連するドキュメントファイル（以下「ソフトウェア」）の複製を入手したすべての人に対し、無料で以下の権利を許可します：
ソフトウェアを使用、コピー、変更、配布、変更後再配布する権利
ただし、以下の条件に従うものとします：
- 商用利用の禁止
  - 本ソフトウェアおよびその派生物を商用目的で使用することはできません。
- 商用利用禁止の継承
  - 本ソフトウェアを変更または派生物を作成した場合、その派生物にも「商用利用不可」の条件を保持しなければなりません。
- [ウィザーズ・オブ・ザ・コースト社のファンコンテンツポリシー](https://company.wizards.com/ja/legal/fancontentpolicy)の遵守
- 公開停止の要望に従う義務と継承
  - 著作者による公開停止の要望があった際、本ソフトウェア及びその派生物の再配布はいかなる形に置いても禁止されます。

本ソフトウェアは「As-Is」で提供され、いかなる種類の明示または黙示の保証もありません。
いかなる場合も、製作者は、本ソフトウェアまたはその使用、もしくはその他の取引に起因または関連して生じるいかなる請求、損害、またはその他の責任についても、一切の責任を負いません。

ただし、本レポジトリには[UnityCapture](https://github.com/schellingb/UnityCapture)を(URP Rendererに動作するように)改変した部分を含んでおり、その派生ファイルはUnityCaptureのライセンス(MITライセンス及びzlibライセンス)に従います。

# セットアップ
1. 当レポジトリをダウンロードします。
2. Unity Hubをインストールします。
3. 映像を出力したい場合、[UnityCapture](https://github.com/schellingb/UnityCapture)をインストールします。
4. Unity2022.3.36f1をインストールし、「開く」→「ディスクから加える」で本プロジェクトをUnity Hubに登録して、開きます。
<p align="center">
  <img src="https://github.com/user-attachments/assets/0304bfa0-a31c-4b6f-a842-b114a8ee0aff" width="300" />
</p>
5. ProjectビューからDevelopSceneを開きます。
6. DevelopSceneのHierarchyビューの中に、GameSettingというオブジェクトがあります。そこで、ゲームモード(オリジナル・デュエパーティ)、デッキ、パートナーを設定できます。
<p align="center">
  <img src="https://github.com/user-attachments/assets/abbf48e0-d4a8-4236-a414-8d31be6a7cae" width="300" />
</p>
7. 再生ボタンを押すと動作します。

# デッキの準備
0. デフォルトでは、トランプの画像がデッキとして、またDMSimulatorのそれらしい画像がカード裏面として準備されています。
1. 画像を用意します。
2. ProjectビューのResources/MyFolderの中に、フォルダを作り、そこに画像をD&Dなどで入れます。
3. カードを全て選択し、Texture TypeをSprite (2D and UI)にしてApplyします。
<p align="center">
  <img src="https://github.com/user-attachments/assets/a8bb9450-5158-4e67-911c-4de700a2258f" width="300" />
</p>
4. GameSettingのDeck Folderにデッキのフォルダ名を設定し、Partnerにパートナーの画像をD&Dします。
5. シーンを再生します。用意したデッキになっているでしょう。

# 機能詳細
## ドラッグ＆ドロップ:カードの移動
カードを左クリックしてゾーン間を移動させることができます。ctrlキーを押したまま左ボタンを離すとタップインします。shiftキーを押すと、表示状態が変わらないままに、カードを別のカードの上にのせることができます。(ex. 手札からシールドの上に表向きでおく、山札からクリーチャーの上に置いて封印する。)
上に置いたカードは、ゾーンの端っこのカードが存在しない場所にドロップすると上に置かれる状態を解除できます。また、ゾーン間を移動することによっても上に置かれる状態は解除されます。
shiftキーを押さずにカードを別のカードの上に乗せると、カードを並び替えることができます。カードの左側に置くと左に、右側に置くと右に挿入されます。
また、カードをダブルクリックするとタップ・アンタップが切り替わります。

別のゾーンにカードを移動させた時、基本的にはゾーンのカードの一番上、左に移動します。ただし、デッキにカードを移動させたときだけ、ゾーンの一番下に移動します。(つまり、墓地は先入れ後出し、山札は後入れ後出しとなります。)
デッキの上にカードを移動させたいときは、shiftキーを押しながらデッキの一番上のカードの上にドロップします。

## パイメニューによる操作
カード、及び各ゾーンのカードが存在しない場所の上で左クリックを押すと、pieメニューが開きます。ボタンを押したままマウスを動かすことでアクションを選択します。ボタンを離すと、選択された(ハイライトされた)アクションが実行されます。

ゾーンに対応するパイメニューはマナゾーン: M、バトルゾーン: B、デッキ: D、墓地: G、シールド: S、手札: H、パートナーゾーン(超次元と共通): Pなどのキーを押しても開くことができます。この状態で数字キー(半角全角と同じ行にある方、Numpadの方は未確認)を押すと対応するアクションが実行されます。(ex. mキーを押しているときに3を押すと、マナが3枚タップされる。Dキーを押しているときに1を押すとドローできる。)

### カード
<p align="center">
  <img src="https://github.com/user-attachments/assets/55a3533e-cfd7-4abc-a6ba-e5198747e077" width="300"/>
</p>

1. Tap : カードをタップします。
2. Untap : カードをアンタップします。
3. Above : カードを左のカードの上に置きます。 (shiftキー + D&Dで代用可能)
4. Below : カードの左のカードの下に置きます。
5. FaceUp : カードを表向きにします。
6. FaceDown : カードを裏向きにします。
7. Check : カードを手元では見え、配信では見えない状態(Hidden)にします。この時、カメラ映像側の画面ではカードに青みがかかります。シールドチェックなどにも使えます。
<p align="center">
  <img src="https://github.com/user-attachments/assets/b70cc6ad-18db-472c-b155-42118dfec16f" width="300"/>
</p>
8. isField : バトルゾーンにあるカードにフィールド属性を与えることができます。フィールドカードはアンタップ状態で横向きに、タップ状態で上下が逆になります。もう一度押すとフィールド属性を解除できます。

### マナゾーン
<p align="center">
  <img src="https://github.com/user-attachments/assets/3ebd9462-c8b9-4418-a3b0-0af1fe7f798e" width="300"/>
</p>
1. ~ 8. TapNMana : マナゾーンのカードを纏めてタップできます。文明は考慮しません。mキーを押すとマナゾーンのパイメニューが現れ、そこで数字キーを押すとマナをその数タップできます。
9. UntapAll : マナゾーンを全てアンタップします。
10 TurnStart: バトルゾーンとマナゾーンを全てアンタップし、カードを一枚引きます。ショートカットで実行するときは"D"キーと"0"キーです。

### バトルゾーン
1. UntapAll : バトルゾーンを全てアンタップします。
2. Seal : 山札の上から一枚を裏向きのままバトルゾーンに置きます。(shiftキーとD&Dを使った方が早い)
  
### デッキ
1. Draw : ドローします
2. Shuffle : デッキの中身をシャッフルします。
3. OpenDeck : デッキを展開します。サーチなどの時に。カメラ映像側ではHidden状態で表示されます。
<p align="center">
  <img src="https://github.com/user-attachments/assets/a4610228-a820-4465-8646-37b16a298d3d" width="300"/>
</p>
↑展開後
4. CloseDeck : デッキを閉じます。閉じる時には自動的にシャッフルされます。現状、山札の中身を自由に並べ替えるためには、他のゾーンにカードを移動させた後、手動で重ねていく必要があります。

### シールド
実装したいことが思いつかなかったため操作はありません。

### 墓地、パートナーゾーン
1. OpenXXX : デッキの展開と同様です。
2. CloseXXX : 閉じるのと同様です。

### 一時ゾーン
<p align="center">
  <img src="https://github.com/user-attachments/assets/6caa0cdb-fdec-4b14-ab29-978a6da393dc" width="300"/>
</p>
1. ToggleShow : 一時ゾーンのカードをHidden状態と表向きの状態で交互に切り替えます。つまり、カメラ映像でも手札が映るようになります。新しくゾーンに加えたカードも同じ状態になります。公開しているときは、ゾーン下に黄色くShowと表示されます。
2. Close : 一時ゾーンのカードをデッキの下に戻して閉じます。左側のカードが上になるように重なって戻ります。(任意の順番でデッキの下にカードを戻せるときは、一時ゾーンを使わずバトルゾーンとかに一度カードを置いておいて、一枚ずつ戻した方が早いかもしれません。)
3. CloseShuffle : 一時ゾーンのカードをデッキの下にシャッフルして戻します。

### 手札 
1. ToggleDisclosure : 手札をHidden状態と表向きの状態で交互に切り替えます。つまり、カメラ映像でも手札が映るようになります。新しく引いてきたカードも同じ状態になります。公開しているときは、ゾーン下の数字が黄色になります。

## その他の操作
- スペースキーを押している間カードのプレビューが表示されます。プレビューの表示状態はカードの状態と等しくなります。
<p align="center">
  <img src="https://github.com/user-attachments/assets/3794061d-426e-441d-8052-e5ed4fa29162" width="300"/>
</p>
- Tabキーを押すと一時ゾーンが展開されます。

# Q&A
- 仮想カメラが出力されない
  - DevelopSceneのヒエラルキーの中にあるBroadCastCameraのUnity Captureスクリプトがオンになっていること、Resize ModeがLinear Resizeになっていることを確認ください。
  - ここの設定で左右反転出力も設定できます。 
<p align="center">
  <img src="https://github.com/user-attachments/assets/9160ab6e-ae65-4049-b057-cd2862b91ca2" width="300"/>
</p>



# 参考
- https://deck-simulator.com/
- https://picodoromeda.com/archives-dm-79/
- https://github.com/sindreslungaard/duel-masters
- https://dmvault.ath.cx/
- https://github.com/schellingb/UnityCapture
